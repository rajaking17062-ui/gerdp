name: Free Germany RDP (LocalXpose)

on:
  workflow_dispatch:
    inputs:
      LXP_TOKEN:
        description: 'Paste your LocalXpose Token (https://localxpose.io)'
        required: true

jobs:
  rdp:
    runs-on: windows-latest

    steps:
    - name: 🔐 Create RDP User
      shell: powershell
      run: |
        net user GermanyUser GerRDP123! /add
        net localgroup "Remote Desktop Users" GermanyUser /add
        net localgroup Administrators GermanyUser /add

    - name: 🔓 Enable RDP and Firewall
      shell: powershell
      run: |
        Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server" -Name fDenyTSConnections -Value 0
        Enable-NetFirewallRule -DisplayGroup "Remote Desktop"

    - name: 🌐 Install LocalXpose
      shell: powershell
      run: |
        Invoke-WebRequest https://api.localxpose.io/api/v2/downloads/lxcli/windows-amd64 -OutFile lx.exe

    - name: 🚀 Start LocalXpose Tunnel (RDP)
      shell: powershell
      run: |
        .\lx.exe authtoken ${{ github.event.inputs.LXP_TOKEN }}
        Start-Process -NoNewWindow -FilePath ".\lx.exe" -ArgumentList "tcp 3389" 
        Start-Sleep -Seconds 20

    - name: 🖥️ Show RDP Info
      shell: powershell
      run: |
        Write-Host "✅ Germany RDP Created via LocalXpose"
        Write-Host "👤 Username: GermanyUser"
        Write-Host "🔑 Password: GerRDP123!"
        Write-Host "🔗 Tunnel running — check your LocalXpose dashboard for RDP address"
